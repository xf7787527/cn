# 消息推送服务

## 支持的消息推送类型
1) 自定义消息：提供json格式的自定义消息透传服务；
2) 通知类消息：基于IoT助手APP可以免开发实现以下通知类消息推送服务：
      	应急通知（如：发生重大事件时，政府统一发布的紧急通知）；
      	业务提醒通知；

## 消息全生命周期路径可追溯
1) 状态确定性保障：基于MQTT+HTTPS的双路通讯机制保障消息状态的确定性；
2) 消息路径的可追溯性：
      	消息全生命周期路径都有详细记录和跟踪，包括：操作账号、API网关节点、消息下行处理路径节点（MQTT服务节点、设备通讯模块、设备业务执行模块）、消息上行处理路径节点（设备业务执行模块、消息回执服务器网关、数据状态更新模块）；
      	消息全生命周期路径提供可视化的查询视图，并提供性能分析报告；

## MoMQ服务器

**针对物联网消息推送场景，自主开发了MQTT服务器MoMQ，MoMQ与传统的MQTT服务器性能对比优势明显，是商业物联管理系统消息推送服务实现高并发、低延时服务能力的重要保障。以下是MoMQ和业界常用的EMQ和Mosquitto进行的基准测试比较：**

<table>
    <tr>
        <td></td>
        <th>项目</th>
        <th>MoMQ</th>
        <th>EMQ</th>
        <th>Mosquitto</th>
    </tr>
    <tr>
        <td rowspan="7">消息送达时效</td>
        <td>TP50</td>
        <td>13ms</td>
        <td>161ms</td>
        <td>186ms</td>
    </tr>
    <tr>
        <td>TP50平均</td>
        <td>6.7ms</td>
        <td>71.8ms</td>
        <td>186ms</td>
    </tr>
    <tr>
        <td>TP90</td>
        <td>40ms</td>
        <td>432ms</td>
        <td>230ms</td>
    </tr>
    <tr>
        <td>TP90平均</td>
        <td>12.3ms</td>
        <td>160ms</td>
        <td>187ms</td>
    </tr>
    <tr>
        <td>TP99</td>
        <td>212ms</td>
        <td>765ms</td>
        <td>267ms</td>
    </tr>
    <tr>
        <td>TP99平均</td>
        <td>20.8ms</td>
        <td>194ms</td>
        <td>192ms</td>
    </tr>
    <tr>
        <td>总平均</td>
        <td>23.0ms</td>
        <td>203ms</td>
        <td>193ms</td>
    </tr>
    <tr>
        <td>吞吐量</td>
        <td>TPS</td>
        <td>129,726</td>
        <td>18,592</td>
        <td>20,473</td>
    </tr>
    <tr>
        <td>最大并发连接数</td>
        <td>8C32G</td>
        <td>1000万</td>
        <td>130万</td>
        <td>--</td>
    </tr>
</table>

**测试环境及测试方法说明：**

[1]	两台服务器centos 7.4/4个逻辑CPU/8G内存，其中一台部署MQTT消息服务器，一台部署测试客户端程序；

[2]	测试方式为建立5000个MQTT长连接，交叉发送消息；

[3]	消息送达时间是指消息从发送到接收方收到消息的时长。

## 支持推送审核及敏感词检查

1)	商业物联管理系统支持消息推送审核：当推送设备达到一定量级时，需要运营负责人审核之后，推送任务才能执行；
2)	商业物联管理系统消息推送引入敏感词词库：推送的消息内容中出现敏感词时，限制推送；

## 支持终止消息推送任务
1)	商业物联管理系统支持终止推送任务：推送任务执行完毕之前，可通过平台指令或API方式终止推送；
